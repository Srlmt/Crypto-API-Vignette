
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.path = "../images/")
```


```{r, include = FALSE, eval=FALSE}
rmarkdown::render("_Rmd/Vignette.Rmd", 
          output_format = "github_document", 
          output_dir = getwd(),
          output_file = "README.md",
          output_options = list(
            html_preview = FALSE,
            toc = TRUE,
            toc_depth = 2
            )
          )
```

# Interacting with Crypto API

# Requirements

```{r requirements, message=FALSE, warning=FALSE}
library(tidyverse)
library(jsonlite)
library(knitr)
library(lubridate)
APIkey="r87x5acIqxjYxZWZ31xO3dxUjQGVlja6"
```

# Functions to Interact with API

$~$

## `getExchange` 

Description: Function to get Crypto Exchanges Data

Input: None

Output: Returns a table of exchange data information

```{r exchange}

getExchange <- function(){
  
# Build the URL  
baseURL <- "https://api.polygon.io/v1/meta/crypto-exchanges/"
key <- paste0("?apiKey=", APIkey)
URL <- paste0(baseURL, key)

# Use the URL to retrieve data from API
exchangeData <- fromJSON(URL)

return(exchangeData)
}

# Sample Function Call
kable(getExchange())
```

$~$

## `getExchange` 

Description: Function to get the daily grouped data for the entire Crypto market

Input: Date in "YYYY-MM-DD" format

Output: Returns a table of containing crypto market information for the input date

```{r DailyMarket}
getDailyMarket <- function(date=Sys.Date()){

# Build the URL
baseURL <- "https://api.polygon.io/v2/aggs/grouped/locale/global/market/crypto/"
key <- paste0("?apiKey=", APIkey)
day <- date
URL <- paste0(baseURL, day, key)

# Use the URL to retrieve data from API
rawList <- fromJSON(URL)
rawData <- rawList$results

return(rawData)
}

# Sample Function Call
kable(head(getDailyMarket("2021-09-30")))

dailyMarket <- getDailyMarket("2021-09-30")
```


## `getAggregates` 

Description: Function to get 1-year aggregate data for a cryptocurrency pair ending at a given date

Input: Date in "YYYY-MM-DD" format

Output: Returns a table of containing crypto market information such as daily volume and price

```{r}
# Retrieve the date 1 year prior to the input date
date = "2021-09-29"
dayEnd <- as.Date(date)
dayStart <- dayEnd - 365

reference <- cbind(c("BTCUSD", "ETHUSD", "ADAUSD"),
                   c("BITCOIN", "ETHEREUM", "CARDANO")
                  )

# Build the URL
baseURL <- "https://api.polygon.io/v2/aggs/ticker/"
ticker <- paste0("X:", "BTCUSD", "/")
range <- "range/1/day/"
otherSettings <- "?adjusted=true&sort=asc&limit=366"
key <- paste0("&apiKey=", APIkey)
URL <- paste0(baseURL, ticker, range, dayStart, "/", dayEnd, otherSettings, key)

# Use the URL to retrieve data from API
rawList <- fromJSON(URL)
rawData <- rawList$results

# Select Variables for the output dataset
date_range <- as.Date(c(dayStart:dayEnd), origin = "1970-01-01")

# Get the Quarter of the date
qtr <- paste0(year(cryptoData$Date), " Q", quarter(cryptoData$Date))

cryptoData <- data.frame(qtr, date_range, rawData$v, rawData$c)
colnames(cryptoData) <- c("Quarter", "Date", "Volume", "Closing Price")



```


# Data Exploration



```{r}

# Calculate percent change
price <- cryptoData$`Closing Price`

change1Day <- (price[366] - price[365]) / price[365]
change7Day <- (price[366] - price[359]) / price[359]
change30Day <-(price[366] - price[336]) / price[336]
change365Day <- (price[366] - price[1]) / price[1]

kable(cbind(price[366], change1Day, change7Day, change30Day, change365Day), nrow=1)
  
plot(x=cryptoData$Date, y= cryptoData$`Closing Price`)

```

## Bitcoin Trading Volume

We can examine the Bitcoin trading Volume by looking at the Box plot. 

```{r Boxplot}
ggplot(cryptoData, aes(Quarter, Volume)) +
   geom_boxplot(size=1) +
   geom_jitter(aes(y=Volume, fill=Quarter, color=Quarter), size=2) +
   labs(title="Boxplot for Bitcoin Trading Volume by Quarter") +
   theme(text=element_text(size=16), 
         panel.grid.major = element_line(size=1.5),
         axis.ticks = element_line(size=1.4),
         axis.ticks.length = unit(0.20, 'cm'))
```





